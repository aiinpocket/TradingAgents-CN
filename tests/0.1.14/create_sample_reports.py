#!/usr/bin/env python3
"""
å‰µå»ºç¤ºä¾‹åˆ†æå ±å‘Š
ç”¨æ–¼æ¸¬è©¦Webç•Œé¢çš„å ±å‘Šé¡¯ç¤ºåŠŸèƒ½
"""

import sys
import os
from datetime import datetime

# æ·»åŠ é …ç›®è·¯å¾‘
sys.path.append(os.path.join(os.path.dirname(__file__), 'web'))

def create_sample_report(stock_symbol: str, stock_name: str):
    """å‰µå»ºç¤ºä¾‹åˆ†æå ±å‘Š"""
    
    # åˆ†æçµæœæ•¸æ“š
    analysis_results = {
        "summary": f"{stock_name}({stock_symbol}) ç¶œåˆåˆ†æé¡¯ç¤ºè©²è‚¡ç¥¨å…·æœ‰è‰¯å¥½çš„æŠ•è³‡æ½›åŠ›ï¼Œå»ºè­°é—œæ³¨ã€‚",
        "analysts": ["market_analyst", "fundamentals_analyst", "trader_agent"]
    }
    
    # å ±å‘Šå…§å®¹
    reports = {
        "final_trade_decision": f"""# {stock_name}({stock_symbol}) æœ€çµ‚äº¤æ˜“æ±ºç­–

## ğŸ“Š æŠ•è³‡å»ºè­°
**è¡Œå‹•**: è²·å…¥
**ç½®ä¿¡åº¦**: 85%
**é¢¨éšªè©•åˆ†**: 25%
**ç›®æ¨™åƒ¹æ ¼**: ç•¶å‰åƒ¹æ ¼ä¸Šæ¼²15-20%

## ğŸ¯ é—œéµè¦é»
- æŠ€è¡“é¢é¡¯ç¤ºä¸Šæ¼²è¶¨å‹¢
- åŸºæœ¬é¢è²¡å‹™ç‹€æ³è‰¯å¥½
- å¸‚å ´æƒ…ç·’ç©æ¥µ
- é¢¨éšªå¯æ§

## ğŸ’¡ åˆ†ææ¨ç†
åŸºæ–¼å¤šç¶­åº¦åˆ†æï¼Œè©²è‚¡ç¥¨åœ¨æŠ€è¡“é¢ã€åŸºæœ¬é¢å’Œå¸‚å ´æƒ…ç·’æ–¹é¢éƒ½è¡¨ç¾è‰¯å¥½ã€‚æŠ€è¡“æŒ‡æ¨™é¡¯ç¤ºçªç ´é—œéµé˜»åŠ›ä½ï¼Œæˆäº¤é‡æ”¾å¤§ç¢ºèªä¸Šæ¼²è¶¨å‹¢ã€‚åŸºæœ¬é¢åˆ†æé¡¯ç¤ºå…¬å¸è²¡å‹™ç©©å¥ï¼Œç›ˆåˆ©èƒ½åŠ›å¼·ã€‚ç¶œåˆè©•ä¼°å»ºè­°è²·å…¥ä¸¦æŒæœ‰ã€‚

## âš ï¸ é¢¨éšªæç¤º
- å¸‚å ´æ•´é«”æ³¢å‹•é¢¨éšª
- è¡Œæ¥­æ”¿ç­–è®ŠåŒ–é¢¨éšª
- å»ºè­°è¨­ç½®æ­¢æä½
""",

        "fundamentals_report": f"""# {stock_name}({stock_symbol}) åŸºæœ¬é¢åˆ†æå ±å‘Š

## ğŸ“ˆ è²¡å‹™æŒ‡æ¨™åˆ†æ
### ç›ˆåˆ©èƒ½åŠ›
- **æ·¨åˆ©æ½¤å¢é•·ç‡**: 15.2% (åŒæ¯”)
- **ROE**: 18.5%
- **ROA**: 12.3%
- **æ¯›åˆ©ç‡**: 35.8%

### å„Ÿå‚µèƒ½åŠ›
- **è³‡ç”¢è² å‚µç‡**: 45.2%
- **æµå‹•æ¯”ç‡**: 2.1
- **é€Ÿå‹•æ¯”ç‡**: 1.8
- **åˆ©æ¯ä¿éšœå€æ•¸**: 8.5

### é‹ç‡Ÿèƒ½åŠ›
- **ç¸½è³‡ç”¢å‘¨è½‰ç‡**: 1.2
- **å­˜è²¨å‘¨è½‰ç‡**: 6.8
- **æ‡‰æ”¶å¸³æ¬¾å‘¨è½‰ç‡**: 9.2

## ğŸ¢ å…¬å¸åŸºæœ¬æƒ…æ³
- **è¡Œæ¥­åœ°ä½**: è¡Œæ¥­é¾é ­ä¼æ¥­
- **ä¸»ç‡Ÿæ¥­å‹™**: ç©©å®šå¢é•·
- **å¸‚å ´ä»½é¡**: æŒçºŒæ“´å¤§
- **ç«¶çˆ­å„ªå‹¢**: æŠ€è¡“é ˜å…ˆï¼Œå“ç‰ŒçŸ¥ååº¦é«˜

## ğŸ“Š ä¼°å€¼åˆ†æ
- **PE**: 15.2å€ (åˆç†ä¼°å€¼å€é–“)
- **PB**: 2.1å€
- **PEG**: 0.8 (ä½æ–¼1ï¼Œå…·æœ‰æŠ•è³‡åƒ¹å€¼)

## ğŸ’° æŠ•è³‡äº®é»
1. è²¡å‹™ç‹€æ³ç©©å¥ï¼Œç›ˆåˆ©èƒ½åŠ›å¼·
2. è¡Œæ¥­åœ°ä½ç©©å›ºï¼Œç«¶çˆ­å„ªå‹¢æ˜é¡¯
3. ä¼°å€¼åˆç†ï¼Œå…·æœ‰æŠ•è³‡åƒ¹å€¼
4. åˆ†ç´…æ”¿ç­–ç©©å®šï¼Œè‚¡æ±å›å ±è‰¯å¥½
""",

        "market_report": f"""# {stock_name}({stock_symbol}) æŠ€è¡“é¢åˆ†æå ±å‘Š

## ğŸ“ˆ åƒ¹æ ¼è¶¨å‹¢åˆ†æ
### çŸ­æœŸè¶¨å‹¢ (5-20æ—¥)
- **è¶¨å‹¢æ–¹å‘**: ä¸Šæ¼²
- **æ”¯æ’ä½**: Â¥45.20
- **é˜»åŠ›ä½**: Â¥52.80
- **ç•¶å‰ä½ç½®**: çªç ´å‰æœŸé«˜é»

### ä¸­æœŸè¶¨å‹¢ (20-60æ—¥)
- **è¶¨å‹¢æ–¹å‘**: ä¸Šæ¼²
- **ä¸»è¦æ”¯æ’**: Â¥42.50
- **ç›®æ¨™ä½**: Â¥55.00
- **è¶¨å‹¢å¼·åº¦**: å¼·

## ğŸ“Š æŠ€è¡“æŒ‡æ¨™åˆ†æ
### è¶¨å‹¢æŒ‡æ¨™
- **MA5**: 48.50 (åƒ¹æ ¼åœ¨å‡ç·šä¸Šæ–¹)
- **MA20**: 46.80 (å¤šé ­æ’åˆ—)
- **MA60**: 44.20 (é•·æœŸä¸Šæ¼²è¶¨å‹¢)

### å‹•é‡æŒ‡æ¨™
- **RSI(14)**: 68.5 (åå¼·ï¼Œæœªè¶…è²·)
- **MACD**: é‡‘å‰å‘ä¸Š
- **KDJ**: K=75, D=68, J=82 (å¼·å‹¢å€åŸŸ)

### æˆäº¤é‡åˆ†æ
- **æˆäº¤é‡**: æ”¾é‡ä¸Šæ¼²
- **é‡åƒ¹é—œç³»**: åƒ¹æ¼²é‡å¢ï¼Œå¥åº·ä¸Šæ¼²
- **æ›æ‰‹ç‡**: 3.2% (æ´»èº)

## ğŸ¯ æ“ä½œå»ºè­°
### è²·å…¥ä¿¡è™Ÿ
- çªç ´å‰æœŸé«˜é»
- æˆäº¤é‡é…åˆ
- æŠ€è¡“æŒ‡æ¨™å‘å¥½

### é—œéµä½ç½®
- **è²·å…¥ä½**: Â¥48.00-49.00
- **æ­¢æä½**: Â¥45.00
- **ç›®æ¨™ä½**: Â¥55.00

## âš ï¸ é¢¨éšªæç¤º
- æ³¨æ„å¤§ç›¤æ•´é«”èµ°å‹¢
- é—œæ³¨æˆäº¤é‡è®ŠåŒ–
- è¨­ç½®åˆç†æ­¢æä½
"""
    }
    
    return analysis_results, reports

def main():
    """ä¸»å‡½æ•¸"""
    print("ğŸ¨ å‰µå»ºç¤ºä¾‹åˆ†æå ±å‘Š...")
    
    try:
        from web.utils.mongodb_report_manager import mongodb_report_manager
        
        if not mongodb_report_manager.connected:
            print("âŒ MongoDBæœªé€£æ¥")
            return
        
        # å‰µå»ºå¤šå€‹ç¤ºä¾‹å ±å‘Š
        sample_stocks = [
            ("DEMO001", "ç¤ºä¾‹ç§‘æŠ€è‚¡"),
            ("DEMO002", "ç¤ºä¾‹éŠ€è¡Œè‚¡"),
            ("DEMO003", "ç¤ºä¾‹æ¶ˆè²»è‚¡"),
            ("000001", "å¹³å®‰éŠ€è¡Œ"),
            ("000002", "è¬ç§‘A")
        ]
        
        success_count = 0
        
        for stock_symbol, stock_name in sample_stocks:
            print(f"ğŸ“ å‰µå»º {stock_name}({stock_symbol}) çš„åˆ†æå ±å‘Š...")
            
            analysis_results, reports = create_sample_report(stock_symbol, stock_name)
            
            success = mongodb_report_manager.save_analysis_report(
                stock_symbol=stock_symbol,
                analysis_results=analysis_results,
                reports=reports
            )
            
            if success:
                success_count += 1
                print(f"âœ… {stock_name} å ±å‘Šå‰µå»ºæˆåŠŸ")
            else:
                print(f"âŒ {stock_name} å ±å‘Šå‰µå»ºå¤±æ•—")
        
        print(f"\nğŸ‰ å®Œæˆï¼æˆåŠŸå‰µå»º {success_count}/{len(sample_stocks)} å€‹ç¤ºä¾‹å ±å‘Š")
        print("ğŸ’¡ ç¾åœ¨å¯ä»¥åœ¨Webç•Œé¢ä¸­æŸ¥çœ‹é€™äº›å ±å‘Šäº†")
        
    except Exception as e:
        print(f"âŒ å‰µå»ºç¤ºä¾‹å ±å‘Šå¤±æ•—: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    main()
