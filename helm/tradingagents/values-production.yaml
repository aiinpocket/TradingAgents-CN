# =============================================================
# TradingAgents-CN - Production Values (kubeinpocket.com)
# =============================================================
# K8s Cluster: TaipeiCenter
# Domain: https://stock-us.aiinpocket.com
# Namespace: app
# Registry: ghcr.io
# Storage: NFS (nfs-client StorageClass)
# TLS: Cloudflare Origin Certificate
# =============================================================

replicaCount: 1

image:
  repository: ghcr.io/aiinpocket/tradingagents-cn
  pullPolicy: Always
  tag: "0d620bc"

imagePullSecrets:
  - name: ghcr-secret
fullnameOverride: "tradingagents"

podAnnotations: {}

# =============================================================
# Service
# =============================================================
service:
  type: ClusterIP
  port: 8501

# =============================================================
# Ingress - stock-us.aiinpocket.com
# =============================================================
ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-http-version: "1.1"
  hosts:
    - host: stock-us.aiinpocket.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: cloudflare-origin-cert-aiinpocket
      hosts:
        - stock-us.aiinpocket.com

# =============================================================
# Resources
# =============================================================
resources:
  limits:
    cpu: 2000m
    memory: 2Gi
  requests:
    cpu: 500m
    memory: 512Mi

# =============================================================
# Autoscaling
# =============================================================
autoscaling:
  enabled: true
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

nodeSelector: {}
tolerations: []
affinity: {}

# =============================================================
# Network Policy - 限制 pod 間通訊
# =============================================================
networkPolicy:
  enabled: true

# =============================================================
# Health Checks
# =============================================================
healthCheck:
  liveness:
    path: /health
    initialDelaySeconds: 120
    periodSeconds: 15
    timeoutSeconds: 5
    failureThreshold: 5
  readiness:
    path: /health
    initialDelaySeconds: 60
    periodSeconds: 10
    timeoutSeconds: 3
    failureThreshold: 3

# =============================================================
# Application Configuration
# =============================================================
config:
  environment: "production"
  timezone: "Asia/Taipei"
  logLevel: "INFO"
  llmProvider: "openai"
  memoryEnabled: "true"
  cacheType: "redis"

# =============================================================
# Secrets - 由外部管理，Helm 不建立 Secret
# =============================================================
# 生產環境的敏感值請透過 kubectl 手動建立：
#   kubectl create secret generic tradingagents-secret \
#     --namespace app \
#     --from-literal=OPENAI_API_KEY=sk-xxx \
#     --from-literal=ANTHROPIC_API_KEY=sk-ant-xxx \
#     --from-literal=FINNHUB_API_KEY=xxx \
#     --from-literal=COOKIE_SECRET_KEY=xxx \
#     --from-literal=MONGODB_PASSWORD=xxx \
#     --from-literal=REDIS_PASSWORD=xxx
#
# 或更新已存在的 Secret：
#   kubectl create secret generic tradingagents-secret \
#     --namespace app --dry-run=client -o yaml \
#     --from-literal=OPENAI_API_KEY=sk-xxx \
#     --from-literal=ANTHROPIC_API_KEY=sk-ant-xxx \
#     --from-literal=FINNHUB_API_KEY=xxx \
#     --from-literal=COOKIE_SECRET_KEY=xxx \
#     --from-literal=MONGODB_PASSWORD=xxx \
#     --from-literal=REDIS_PASSWORD=xxx \
#     | kubectl apply -f -
# =============================================================
secrets:
  enabled: false

# =============================================================
# MongoDB - Standalone Deployment
# =============================================================
mongodb:
  enabled: true
  image: mongo:7.0
  port: 27017
  database: tradingagents
  username: admin
  storageClass: "nfs-client"
  storageSize: 5Gi
  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi

# =============================================================
# Redis - Standalone Deployment
# =============================================================
redis:
  enabled: true
  image: redis:7-alpine
  port: 6379
  storageClass: "nfs-client"
  storageSize: 2Gi
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
