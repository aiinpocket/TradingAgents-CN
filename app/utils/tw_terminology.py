"""
台灣慣用術語校正工具
將大陸金融術語確定性替換為台灣慣用說法，
供 trending.py（新聞翻譯/AI 分析）和 analysis.py（分析報告）共用。
"""

import re

# 大陸→台灣中文術語映射
# 注意：左側「來源」欄位刻意保留簡體/大陸用語，因為這些是 LLM 實際輸出的文字，
# 用於比對替換為右側的台灣正體中文。此處簡體字為比對需求，非顯示用途。
_TW_TERMINOLOGY: list[tuple[str, str]] = [
    # 人名
    ("特朗普", "川普"),
    # 公司 / 品牌（中文大陸譯名→台灣譯名）
    ("英偉達", "輝達"),
    ("英伟达", "輝達"),
    # 指數 / 機構（長字串優先處理，避免部分取代衝突）
    ("標準普爾500", "標普500"),
    ("標準普爾", "標普"),
    ("标准普尔", "標普"),
    ("道瓊斯工業平均指數", "道瓊工業指數"),
    ("道瓊斯工業平均", "道瓊工業平均"),
    ("道瓊斯", "道瓊"),
    ("道琼斯", "道瓊"),
    ("納斯達克", "那斯達克"),
    ("纳斯达克", "那斯達克"),
    ("美聯儲", "聯準會"),
    ("美联储", "聯準會"),
    ("聯邦儲備系統", "聯準會"),
    ("聯邦儲備", "聯準會"),
    ("联邦储备", "聯準會"),
    ("聯邦準備理事會", "聯準會"),
    ("聯邦準備", "聯準會"),
    # 市場專有名詞（LLM 中文直譯→台灣慣用）
    ("壯麗七巨頭", "科技七雄"),
    ("七巨頭", "七雄"),
    ("Mag 7", "科技七雄"),
    # 其他金融術語
    ("做空", "放空"),
    ("期權", "選擇權"),
    ("做多", "作多"),
    ("利好", "利多"),
    ("股指期貨", "股價期貨"),
    ("互聯網", "網路"),
    ("信息技術", "資訊科技"),
    ("波動率", "波動度"),
    ("收益率", "殖利率"),
    ("股息率", "殖利率"),
    ("市盈率", "本益比"),
    ("市淨率", "股價淨值比"),
    ("市場份額", "市佔率"),
    ("回調", "回檔"),
    # 科技用語（大陸→台灣）
    ("人工智能", "人工智慧"),
    ("數據中心", "資料中心"),
    ("軟件", "軟體"),
    ("硬件", "硬體"),
    # 公司名（大陸中文譯名→台灣慣用英文名）
    ("谷歌", "Google"),
]

# 中文語境下英文公司名→台灣中文名映射（僅套用於中文翻譯結果）
_EN_TO_TW_COMPANY: list[tuple[str, str]] = [
    ("Nvidia", "輝達"),
    ("NVIDIA", "輝達"),
]


def normalize_tw_terminology(text: str) -> str:
    """將大陸金融術語校正為台灣慣用說法（確定性取代）"""
    for mainland, taiwan in _TW_TERMINOLOGY:
        if mainland in text:
            text = text.replace(mainland, taiwan)
    # 中文語境：英文公司名轉為台灣慣用中文名
    for en_name, tw_name in _EN_TO_TW_COMPANY:
        if en_name in text:
            # 先移除已含中文名的冗餘括號標註
            # 例如「輝達(Nvidia)」或「輝達（Nvidia）」→「輝達」
            pattern = (
                re.escape(tw_name) + r"\s*[（(]\s*"
                + re.escape(en_name) + r"\s*[）)]"
            )
            text = re.sub(pattern, tw_name, text)
            # 再將剩餘的英文名替換為中文名
            text = text.replace(en_name, tw_name)
    return text
