# åˆ†æå¸«å›¢éšŠ

## æ¦‚è¿°

åˆ†æå¸«å›¢éšŠæ˜¯ TradingAgents æ¡†æ¶çš„æ ¸å¿ƒåˆ†æçµ„ä»¶ï¼Œè´Ÿè´£å¾ä¸åŒç¶­åº¦å°è‚¡ç¥¨é€²è¡Œå°ˆæ¥­åˆ†æã€‚å›¢éšŠç”±å››é¡å°ˆæ¥­åˆ†æå¸«çµ„æˆï¼Œæ¯å€‹åˆ†æå¸«éƒ½å°ˆè¨»æ–¼ç‰¹å®šçš„åˆ†æé ˜åŸŸï¼Œé€šéå”ä½œç‚ºæŠ•è³‡æ±ºç­–æä¾›å…¨é¢çš„æ•¸æ“šæ”¯æŒã€‚

## åˆ†æå¸«æ¶æ§‹

### åŸºç¡€åˆ†æå¸«è¨­è¨ˆ

æ‰€æœ‰åˆ†æå¸«éƒ½åŸºæ–¼çµ±ä¸€çš„æ¶æ§‹è¨­è¨ˆï¼Œä½¿ç”¨ç›¸åŒçš„å·¥å…·æ¥å£å’Œæ—¥èªŒç³»çµ±ï¼š

```python
# çµ±ä¸€çš„åˆ†æå¸«æ¨¡å¡Šæ—¥èªŒè£é¥°å™¨
from tradingagents.utils.tool_logging import log_analyst_module

# çµ±ä¸€æ—¥èªŒç³»çµ±
from tradingagents.utils.logging_init import get_logger
logger = get_logger("default")

@log_analyst_module("analyst_type")
def analyst_node(state):
    # åˆ†æå¸«é€»è¾‘å¯¦ç¾
    pass
```

### æ™ºèƒ½é«”ç‹€æ…‹ç®¡ç†

åˆ†æå¸«é€šé `AgentState` é€²è¡Œç‹€æ…‹ç®¡ç†ï¼š

```python
class AgentState:
    company_of_interest: str      # è‚¡ç¥¨ä»£ç¢¼
    trade_date: str              # äº¤æ˜“æ—¥æœŸ
    fundamentals_report: str     # åŸºæœ¬é¢å ±å‘Š
    market_report: str           # å¸‚å ´åˆ†æå ±å‘Š
    news_report: str             # æ–°èåˆ†æå ±å‘Š
    sentiment_report: str        # æƒ…ç»ªåˆ†æå ±å‘Š
    messages: List              # æ¶ˆæ¯æ­·å²
```

## åˆ†æå¸«å›¢éšŠæˆå“¡

### 1. åŸºæœ¬é¢åˆ†æå¸« (Fundamentals Analyst)

**æ–‡ä»¶ä½ç½®**: `tradingagents/agents/analysts/fundamentals_analyst.py`

**æ ¸å¿ƒè·è´£**:
- åˆ†æå…¬å¸è²¡å‹™æ•¸æ“šå’ŒåŸºæœ¬é¢æŒ‡æ¨™
- è©•ä¼°å…¬å¸ä¼°å€¼å’Œè²¡å‹™å¥åº·åº¦
- æä¾›åŸºæ–¼è²¡å‹™æ•¸æ“šçš„æŠ•è³‡å»ºè®®

**æŠ€è¡“ç‰¹æ€§**:
- ä½¿ç”¨çµ±ä¸€å·¥å…·æ¶æ§‹è‡ªå‹•è¯†åˆ¥è‚¡ç¥¨é¡å‹
- æ”¯æŒAè‚¡ã€æ¸¯è‚¡ã€ç¾è‚¡çš„åŸºæœ¬é¢åˆ†æ
- æ™ºèƒ½é¸æ“‡åˆé©çš„æ•¸æ“šæºï¼ˆåœ¨ç·š/é›¢ç·šæ¨¡å¼ï¼‰

**æ ¸å¿ƒå¯¦ç¾**:
```python
def create_fundamentals_analyst(llm, toolkit):
    @log_analyst_module("fundamentals")
    def fundamentals_analyst_node(state):
        ticker = state["company_of_interest"]
        
        # ç²å–è‚¡ç¥¨å¸‚å ´ä¿¡æ¯
        from tradingagents.utils.stock_utils import StockUtils
        market_info = StockUtils.get_market_info(ticker)
        
        # ç²å–å…¬å¸åç¨±
        company_name = _get_company_name_for_fundamentals(ticker, market_info)
        
        # é¸æ“‡åˆé©çš„å·¥å…·
        if toolkit.config["online_tools"]:
            tools = [toolkit.get_stock_fundamentals_unified]
        else:
            # é›¢ç·šæ¨¡å¼å·¥å…·é¸æ“‡
            tools = [...]
```

**æ”¯æŒçš„æ•¸æ“šæº**:
- **Aè‚¡**: çµ±ä¸€æ¥å£ç²å–ä¸­åœ‹è‚¡ç¥¨ä¿¡æ¯
- **æ¸¯è‚¡**: æ”¹é€²çš„æ¸¯è‚¡å·¥å…·
- **ç¾è‚¡**: FinnHubã€SimFinç­‰æ•¸æ“šæº

### 2. å¸‚å ´åˆ†æå¸« (Market Analyst)

**æ–‡ä»¶ä½ç½®**: `tradingagents/agents/analysts/market_analyst.py`

**æ ¸å¿ƒè·è´£**:
- æŠ€è¡“æŒ‡æ¨™åˆ†æï¼ˆRSIã€MACDã€å¸ƒæ—å¸¶ç­‰ï¼‰
- åƒ¹æ ¼è¶‹åŠ¿å’Œåœ–è¡¨æ¨¡å¼è¯†åˆ¥
- æ”¯æ’‘é˜»åŠ›ä½åˆ†æ
- äº¤æ˜“ä¿¡è™Ÿç”Ÿæˆ

**åˆ†æç¶­åº¦**:
- çŸ­æœŸæŠ€è¡“æŒ‡æ¨™
- ä¸­é•·æœŸè¶‹åŠ¿åˆ†æ
- æˆäº¤é‡åˆ†æ
- åƒ¹æ ¼å‹•é‡è©•ä¼°

### 3. æ–°èåˆ†æå¸« (News Analyst)

**æ–‡ä»¶ä½ç½®**: `tradingagents/agents/analysts/news_analyst.py`

**æ ¸å¿ƒè·è´£**:
- æ–°èäº‹ä»¶å½±éŸ¿åˆ†æ
- å®è§€ç¶“æ¿Ÿæ•¸æ“šè§£è®€
- æ”¿ç­–å½±éŸ¿è©•ä¼°
- è¡Œæ¥­å‹•æ…‹åˆ†æ

**æ•¸æ“šä¾†æº**:
- Google News API
- FinnHubæ–°èæ•¸æ“š
- å¯¦æ™‚æ–°èæµ
- ç¶“æ¿Ÿæ•¸æ“šç™¼å¸ƒ

**ç‰¹æ®ŠåŠŸèƒ½**:
- æ–°èéæ¿¾å’Œè´¨é‡è©•ä¼°
- æƒ…æ„Ÿåˆ†æå’Œå½±éŸ¿è©•ç´š
- æ™‚æ•ˆæ€§è©•ä¼°

### 4. ç¤¾äº¤åª’é«”åˆ†æå¸« (Social Media Analyst)

**æ–‡ä»¶ä½ç½®**: `tradingagents/agents/analysts/social_media_analyst.py`

**æ ¸å¿ƒè·è´£**:
- ç¤¾äº¤åª’é«”æƒ…ç»ªåˆ†æ
- æŠ•è³‡è€…æƒ…ç»ªç›£æ¸¬
- èˆ†è«–è¶‹åŠ¿è¯†åˆ¥
- ç†±é»è©±é¡Œè¿½è¹¤

**æ•¸æ“šä¾†æº**:
- Redditè¨è«–æ•¸æ“š
- Twitteræƒ…æ„Ÿæ•¸æ“š
- é‡‘èè«–å›è¨è«–
- ç¤¾äº¤åª’é«”ç†±åº¦æŒ‡æ¨™

### 5. ä¸­åœ‹å¸‚å ´åˆ†æå¸« (China Market Analyst)

**æ–‡ä»¶ä½ç½®**: `tradingagents/agents/analysts/china_market_analyst.py`

**æ ¸å¿ƒè·è´£**:
- å°ˆé–€é’ˆå°ä¸­åœ‹Aè‚¡å¸‚å ´çš„åˆ†æ
- ä¸­åœ‹ç‰¹è‰²çš„å¸‚å ´å› ç´ åˆ†æ
- æ”¿ç­–ç’°å¢ƒå½±éŸ¿è©•ä¼°
- æœ¬åœŸåŒ–çš„æŠ•è³‡é€»è¾‘

## å·¥å…·é›†æˆ

### çµ±ä¸€å·¥å…·æ¶æ§‹

åˆ†æå¸«ä½¿ç”¨çµ±ä¸€çš„å·¥å…·æ¥å£ï¼Œæ”¯æŒè‡ªå‹•è‚¡ç¥¨é¡å‹è¯†åˆ¥ï¼š

```python
# çµ±ä¸€åŸºæœ¬é¢åˆ†æå·¥å…·
tools = [toolkit.get_stock_fundamentals_unified]

# å·¥å…·å…§éƒ¨è‡ªå‹•è¯†åˆ¥è‚¡ç¥¨é¡å‹ä¸¦èª¿ç”¨ç›¸æ‡‰æ•¸æ“šæº
# - Aè‚¡: ä½¿ç”¨ä¸­åœ‹è‚¡ç¥¨æ•¸æ“šæ¥å£
# - æ¸¯è‚¡: ä½¿ç”¨æ¸¯è‚¡å°ˆç”¨æ¥å£
# - ç¾è‚¡: ä½¿ç”¨FinnHubç­‰åœ‹é™…æ•¸æ“šæº
```

### åœ¨ç·š/é›¢ç·šæ¨¡å¼

**åœ¨ç·šæ¨¡å¼** (`online_tools=True`):
- ä½¿ç”¨å¯¦æ™‚APIæ•¸æ“š
- æ•¸æ“šæœ€æ–°ä½†æˆæœ¬è¼ƒé«˜
- é©åˆç”Ÿç”¢ç’°å¢ƒ

**é›¢ç·šæ¨¡å¼** (`online_tools=False`):
- ä½¿ç”¨ç·©å­˜æ•¸æ“š
- æˆæœ¬ä½ä½†æ•¸æ“šå¯èƒ½æ»å¾Œ
- é©åˆé–‹ç™¼å’Œæ¸¬è©¦

## è‚¡ç¥¨é¡å‹æ”¯æŒ

### å¸‚å ´è¯†åˆ¥æ©Ÿåˆ¶

```python
from tradingagents.utils.stock_utils import StockUtils
market_info = StockUtils.get_market_info(ticker)

# è¿”å›ä¿¡æ¯åŒ…æ‹¬ï¼š
# - is_china: æ˜¯å¦ç‚ºAè‚¡
# - is_hk: æ˜¯å¦ç‚ºæ¸¯è‚¡
# - is_us: æ˜¯å¦ç‚ºç¾è‚¡
# - market_name: å¸‚å ´åç¨±
# - currency_name: è²¨å¸åç¨±
# - currency_symbol: è²¨å¸ç¬¦è™Ÿ
```

### æ”¯æŒçš„å¸‚å ´

1. **ä¸­åœ‹Aè‚¡**
   - è‚¡ç¥¨ä»£ç¢¼æ ¼å¼ï¼š000001, 600000ç­‰
   - è²¨å¸å–®ä½ï¼šäººæ°‘å¸(CNY)
   - æ•¸æ“šæºï¼šçµ±ä¸€ä¸­åœ‹è‚¡ç¥¨æ¥å£

2. **é¦™æ¸¯è‚¡å¸‚**
   - è‚¡ç¥¨ä»£ç¢¼æ ¼å¼ï¼š0700.HK, 00700ç­‰
   - è²¨å¸å–®ä½ï¼šæ¸¯å¸(HKD)
   - æ•¸æ“šæºï¼šæ”¹é€²çš„æ¸¯è‚¡å·¥å…·

3. **ç¾åœ‹è‚¡å¸‚**
   - è‚¡ç¥¨ä»£ç¢¼æ ¼å¼ï¼šAAPL, TSLAç­‰
   - è²¨å¸å–®ä½ï¼šç¾å…ƒ(USD)
   - æ•¸æ“šæºï¼šFinnHub, Yahoo Financeç­‰

## åˆ†ææµç¨‹

### 1. æ•¸æ“šç²å–éšæ®µ
```mermaid
graph LR
    A[è‚¡ç¥¨ä»£ç¢¼] --> B[å¸‚å ´é¡å‹è¯†åˆ¥]
    B --> C[é¸æ“‡æ•¸æ“šæº]
    C --> D[ç²å–åŸå§‹æ•¸æ“š]
    D --> E[æ•¸æ“šé è™•ç†]
```

### 2. åˆ†æåŸ·è¡Œéšæ®µ
```mermaid
graph TB
    A[åŸå§‹æ•¸æ“š] --> B[åŸºæœ¬é¢åˆ†æå¸«]
    A --> C[å¸‚å ´åˆ†æå¸«]
    A --> D[æ–°èåˆ†æå¸«]
    A --> E[ç¤¾äº¤åª’é«”åˆ†æå¸«]
    
    B --> F[åŸºæœ¬é¢å ±å‘Š]
    C --> G[å¸‚å ´åˆ†æå ±å‘Š]
    D --> H[æ–°èåˆ†æå ±å‘Š]
    E --> I[æƒ…ç»ªåˆ†æå ±å‘Š]
```

### 3. å ±å‘Šç”Ÿæˆéšæ®µ
```mermaid
graph LR
    A[å„åˆ†æå¸«å ±å‘Š] --> B[ç‹€æ…‹æ›´æ–°]
    B --> C[å‚³éçµ¦ç ”ç©¶å“¡å›¢éšŠ]
    C --> D[é€²å…¥è¾©è«–éšæ®µ]
```

## é…ç½®é¸é …

### åˆ†æå¸«é¸æ“‡
```python
# å¯é¸æ“‡çš„åˆ†æå¸«é¡å‹
selected_analysts = [
    "market",        # å¸‚å ´åˆ†æå¸«
    "social",        # ç¤¾äº¤åª’é«”åˆ†æå¸«
    "news",          # æ–°èåˆ†æå¸«
    "fundamentals"   # åŸºæœ¬é¢åˆ†æå¸«
]
```

### å·¥å…·é…ç½®
```python
toolkit_config = {
    "online_tools": True,     # æ˜¯å¦ä½¿ç”¨åœ¨ç·šå·¥å…·
    "cache_enabled": True,    # æ˜¯å¦å•Ÿç”¨ç·©å­˜
    "timeout": 30,           # APIè¶…æ™‚æ™‚é–“
    "retry_count": 3         # é‡è©¦æ¬¡æ•¸
}
```

## æ—¥èªŒå’Œç›£æ§

### çµ±ä¸€æ—¥èªŒç³»çµ±
```python
# æ¯å€‹åˆ†æå¸«éƒ½ä½¿ç”¨çµ±ä¸€çš„æ—¥èªŒç³»çµ±
logger = get_logger("default")

# è©³ç´°çš„èª¿è©¦æ—¥èªŒ
logger.debug(f"ğŸ“Š [DEBUG] åŸºæœ¬é¢åˆ†æå¸«ç¯€é»é–‹å§‹")
logger.info(f"ğŸ“Š [åŸºæœ¬é¢åˆ†æå¸«] æ­£åœ¨åˆ†æè‚¡ç¥¨: {ticker}")
logger.warning(f"âš ï¸ [DEBUG] memoryç‚ºNoneï¼Œè·³éæ­·å²è¨˜å¿†æª¢ç´¢")
```

### æ€§èƒ½ç›£æ§
- åˆ†æè€—æ™‚çµ±è¨ˆ
- APIèª¿ç”¨æ¬¡æ•¸è¿½è¹¤
- éŒ¯èª¤ç‡ç›£æ§
- ç·©å­˜å‘½ä¸­ç‡çµ±è¨ˆ

## æ“´å±•æŒ‡å—

### æ·»åŠ æ–°çš„åˆ†æå¸«

1. **å‰µå»ºåˆ†æå¸«æ–‡ä»¶**
```python
# tradingagents/agents/analysts/custom_analyst.py
from tradingagents.utils.tool_logging import log_analyst_module
from tradingagents.utils.logging_init import get_logger

def create_custom_analyst(llm, toolkit):
    @log_analyst_module("custom")
    def custom_analyst_node(state):
        # è‡ªå®šç¾©åˆ†æé€»è¾‘
        pass
    return custom_analyst_node
```

2. **è¨»å†Šåˆ°ç³»çµ±**
```python
# åœ¨trading_graph.pyä¸­æ·»åŠ 
selected_analysts.append("custom")
```

### æ·»åŠ æ–°çš„æ•¸æ“šæº

1. **å¯¦ç¾æ•¸æ“šæ¥å£**
2. **æ·»åŠ åˆ°å·¥å…·é›†**
3. **æ›´æ–°é…ç½®é¸é …**

## æœ€ä½³å¯¦è¸

### 1. éŒ¯èª¤è™•ç†
- ä½¿ç”¨try-catchåŒ…è£APIèª¿ç”¨
- æä¾›é™ç´šæ–¹æ¡ˆ
- è¨˜éŒ„è©³ç´°éŒ¯èª¤ä¿¡æ¯

### 2. æ€§èƒ½å„ªåŒ–
- å•Ÿç”¨æ•¸æ“šç·©å­˜
- åˆç†è¨­ç½®è¶…æ™‚æ™‚é–“
- é¿å…é‡è¤‡APIèª¿ç”¨

### 3. æ•¸æ“šè´¨é‡
- é©—è­‰æ•¸æ“šå®Œæ•´æ€§
- è™•ç†ç•°å¸¸å€¼
- æä¾›æ•¸æ“šè´¨é‡è©•åˆ†

### 4. å¯ç¶­è­·æ€§
- ä½¿ç”¨çµ±ä¸€çš„ä»£ç¢¼çµæ§‹
- æ·»åŠ è©³ç´°çš„è¨»é‡‹
- éµå¾ªå‘½åè¦ç¯„

## æ•…éšœæ’é™¤

### å¸¸è§å•é¡Œ

1. **APIèª¿ç”¨å¤±è´¥**
   - æª¢æŸ¥ç¶²çµ¡é€£æ¥
   - é©—è­‰APIå¯†é‘°
   - æŸ¥çœ‹é€Ÿç‡é™åˆ¶

2. **æ•¸æ“šæ ¼å¼éŒ¯èª¤**
   - æª¢æŸ¥è‚¡ç¥¨ä»£ç¢¼æ ¼å¼
   - é©—è­‰å¸‚å ´é¡å‹è¯†åˆ¥
   - æŸ¥çœ‹æ•¸æ“šæºå…¼å®¹æ€§

3. **æ€§èƒ½å•é¡Œ**
   - å•Ÿç”¨ç·©å­˜æ©Ÿåˆ¶
   - å„ªåŒ–ä¸¦ç™¼è¨­ç½®
   - å‡å°‘ä¸å¿…è¦çš„APIèª¿ç”¨

### èª¿è©¦æŠ€å·§

1. **å•Ÿç”¨è©³ç´°æ—¥èªŒ**
```python
logger.setLevel(logging.DEBUG)
```

2. **æª¢æŸ¥ç‹€æ…‹å‚³é**
```python
logger.debug(f"ç•¶å‰ç‹€æ…‹: {state}")
```

3. **é©—è­‰å·¥å…·é…ç½®**
```python
logger.debug(f"å·¥å…·é…ç½®: {toolkit.config}")
```

åˆ†æå¸«å›¢éšŠæ˜¯æ•´å€‹TradingAgentsæ¡†æ¶çš„åŸºç¡€ï¼Œé€šéå°ˆæ¥­åŒ–åˆ†å·¥å’Œå”ä½œï¼Œç‚ºå¾Œç»­çš„ç ”ç©¶è¾©è«–å’Œäº¤æ˜“æ±ºç­–æä¾›é«˜è´¨é‡çš„æ•¸æ“šæ”¯æŒã€‚