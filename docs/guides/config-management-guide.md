---
version: cn-0.1.14-preview
last_updated: 2025-01-13
code_compatibility: cn-0.1.14-preview
status: updated
---

# TradingAgents-CN 配置管理指南

> **版本說明**: 本文档基於 `cn-0.1.14-preview` 版本編寫
> **最後更新**: 2025-01-13
> **狀態**: ✅ 已更新 - 詳細的配置管理說明

## 📋 概述

TradingAgents-CN 提供了完整的配置管理和成本統計系統，让您可以：

- 🔧 **統一管理API密鑰和模型配置**
- 💰 **實時跟蹤Token使用和成本**
- 📊 **查看詳細的使用統計和趋势**
- ⚙️ **自定義系統設置和費率**
- 🐳 **Docker環境配置管理**
- 📄 **報告導出配置**
- 🧠 **多LLM模型智能路由**

## 🎉 最新配置管理特性

- 🔑 **統一API管理**: 支持多個LLM提供商的API密鑰管理
- 🧠 **智能模型選擇**: 根據任務類型自動選擇最優模型
- 📄 **配置文件管理**: JSON/TOML格式的配置文件
- 💰 **成本控制**: 實時成本監控和預算管理
- 🔄 **動態配置**: 運行時配置更新
- 🛡️ **安全管理**: 敏感信息加密存储

## 🚀 快速開始

### 1. 啟動Web界面

```bash
# 激活虛擬環境
.\env\Scripts\Activate.ps1  # Windows
source env/bin/activate     # Linux/macOS

# 啟動Web應用
python -m streamlit run web/app.py
```

### 2. 訪問配置管理

1. 在Web界面左侧選擇 **"⚙️ 配置管理"**
2. 選擇要管理的功能：
   - **模型配置** - 管理API密鑰和模型參數
   - **定價設置** - 設置各供應商的費率
   - **使用統計** - 查看Token使用和成本統計
   - **系統設置** - 配置系統默認參數

## 🤖 模型配置管理

### 支持的模型供應商

| 供應商 | 模型示例 | 貨币 | 說明 |
|--------|----------|------|------|
| **阿里百炼** | qwen-turbo, qwen-plus-latest, qwen-max | CNY | 國產模型，推薦使用 |
| **OpenAI** | gpt-3.5-turbo, gpt-4, gpt-4-turbo | USD | 國际領先模型 |
| **Google** | gemini-pro, gemini-pro-vision | USD | Google最新模型 |
| **Anthropic** | claude-3-sonnet, claude-3-opus | USD | 高质量對話模型 |

### 配置步骤

#### **添加新模型**

1. 進入 **"模型配置"** 页面
2. 在 **"添加新模型"** 部分填寫：
   - **供應商**: 選擇模型提供商
   - **模型名稱**: 輸入具體模型名（如 qwen-plus-latest）
   - **API密鑰**: 輸入您的API密鑰
   - **最大Token數**: 設置輸出限制（1000-32000）
   - **溫度參數**: 控制輸出隨機性（0.0-2.0）
   - **啟用模型**: 是否在分析中使用

3. 點擊 **"添加模型"** 保存

#### **編辑現有模型**

1. 在模型列表中選擇要編辑的模型
2. 修改相應參數
3. 點擊 **"保存配置"**

### 模型配置示例

```json
{
  "provider": "dashscope",
  "model_name": "qwen-plus-latest",
  "api_key": "sk-your-api-key-here",
  "max_tokens": 4000,
  "temperature": 0.7,
  "enabled": true
}
```

## 💰 定價設置管理

### 默認費率表

#### **阿里百炼 (CNY/1000 tokens)**
| 模型 | 輸入價格 | 輸出價格 | 說明 |
|------|----------|----------|------|
| qwen-turbo | ¥0.002 | ¥0.006 | 快速響應 |
| qwen-plus | ¥0.004 | ¥0.012 | 平衡性能 |
| qwen-max | ¥0.020 | ¥0.060 | 最强性能 |

#### **OpenAI (USD/1000 tokens)**
| 模型 | 輸入價格 | 輸出價格 | 說明 |
|------|----------|----------|------|
| gpt-3.5-turbo | $0.0015 | $0.002 | 經濟實用 |
| gpt-4 | $0.03 | $0.06 | 强大性能 |
| gpt-4-turbo | $0.01 | $0.03 | 優化版本 |

#### **Google (USD/1000 tokens)**
| 模型 | 輸入價格 | 輸出價格 | 說明 |
|------|----------|----------|------|
| gemini-pro | $0.00025 | $0.0005 | 高性價比 |
| gemini-pro-vision | $0.00025 | $0.0005 | 支持圖像 |

### 自定義定價

1. 進入 **"定價設置"** 页面
2. 選擇要編辑的模型定價
3. 修改：
   - **輸入價格**: 每1000個輸入token的價格
   - **輸出價格**: 每1000個輸出token的價格
   - **貨币**: CNY/USD/EUR
4. 點擊 **"保存定價"**

## 📊 使用統計和成本分析

### 統計數據類型

#### **总體統計**
- **总成本**: 指定時間內的总花費
- **总請求數**: API調用次數
- **輸入Token**: 总輸入token數量
- **輸出Token**: 总輸出token數量

#### **按供應商統計**
- **各供應商成本分布**
- **使用頻率對比**
- **平均成本分析**

#### **使用趋势**
- **每日成本趋势圖**
- **每日請求數趋势**
- **成本變化分析**

### 查看統計

1. 進入 **"使用統計"** 页面
2. 選擇統計時間範围：
   - 最近7天
   - 最近30天
   - 最近90天
   - 最近365天
3. 查看詳細統計圖表和數據

### 成本控制

#### **設置成本警告**
1. 進入 **"系統設置"** 页面
2. 設置 **"成本警告阈值"**
3. 當日成本超過阈值時會收到警告

#### **成本優化建议**
- **選擇合適的模型**: 根據需求選擇性價比最高的模型
- **控制Token使用**: 合理設置最大Token數
- **監控使用趋势**: 定期查看成本統計

## ⚙️ 系統設置

### 基本設置

| 設置項 | 說明 | 默認值 |
|--------|------|--------|
| **默認供應商** | 新分析時的默認模型供應商 | dashscope |
| **默認模型** | 默認使用的模型名稱 | qwen-turbo |
| **啟用成本跟蹤** | 是否記錄Token使用和成本 | 啟用 |
| **成本警告阈值** | 日成本超過此值時警告 | ¥100 |
| **首選貨币** | 成本顯示的首選貨币 | CNY |
| **自動保存使用記錄** | 是否自動保存使用記錄 | 啟用 |
| **最大使用記錄數** | 保留的最大記錄數量 | 10000 |

### 數據管理

#### **導出配置**
- 導出所有配置到JSON文件
- 便於备份和迁移

#### **清空使用記錄**
- 清空所有Token使用記錄
- 釋放存储空間

#### **重置配置**
- 恢複所有配置到默認值
- 谨慎使用此功能

## 🔧 高級功能

### Token使用跟蹤

系統會自動跟蹤每次分析的Token使用：

```python
# 自動記錄的信息
{
    "timestamp": "2025-06-28T10:30:00",
    "provider": "dashscope",
    "model_name": "qwen-plus",
    "input_tokens": 2500,
    "output_tokens": 1200,
    "cost": 0.024,
    "session_id": "analysis_abc123_20250628_1030",
    "analysis_type": "A股_analysis"
}
```

### 成本計算公式

```
总成本 = (輸入Token數 / 1000) × 輸入單價 + (輸出Token數 / 1000) × 輸出單價
```

### 會話跟蹤

每次分析都會生成唯一的會話ID，用於：
- 跟蹤單次分析的完整成本
- 分析不同類型任務的成本差異
- 優化Token使用策略

## 📈 使用場景示例

### 場景1：成本預算管理

**目標**: 控制月度AI使用成本在¥500以內

**操作**:
1. 設置成本警告阈值為¥16.67（500/30天）
2. 選擇性價比高的模型（如qwen-turbo）
3. 定期查看使用統計，調整使用頻率

### 場景2：多模型對比

**目標**: 比較不同模型的性價比

**操作**:
1. 配置多個模型（qwen-turbo, qwen-plus, gpt-3.5-turbo）
2. 對同一股票進行多次分析
3. 在使用統計中比較成本和效果

### 場景3：团隊使用管理

**目標**: 管理团隊的AI使用成本

**操作**:
1. 為不同团隊成員配置不同的會話ID前缀
2. 通過使用統計分析各成員的使用情况
3. 制定使用規範和預算分配

## ⚠️ 註意事項

### 數據安全
- **API密鑰加密存储**: 系統會安全存储您的API密鑰
- **本地數據**: 所有配置和使用記錄都存储在本地
- **定期备份**: 建议定期導出配置進行备份

### 成本控制
- **實時監控**: 定期查看使用統計
- **合理設置**: 根據需求設置合適的Token限制
- **模型選擇**: 選擇適合任務的模型，避免過度使用高成本模型

### 故障排除
- **配置丢失**: 使用"重置配置"功能恢複默認設置
- **成本異常**: 檢查定價設置是否正確
- **統計錯誤**: 清空使用記錄後重新開始統計

## 🔮 未來功能

### 計劃中的功能
- **多貨币汇率轉換**: 自動轉換不同貨币的成本
- **成本預測**: 基於歷史數據預測未來成本
- **使用報告**: 生成詳細的使用報告
- **团隊管理**: 支持多用戶和權限管理
- **API集成**: 提供配置管理的API接口

---

**通過配置管理系統，您可以更好地控制AI使用成本，優化分析效果！** 💰📊
