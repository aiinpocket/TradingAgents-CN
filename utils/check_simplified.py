#!/usr/bin/env python3
"""
æª¢æŸ¥é …ç›®ä¸­æ˜¯å¦é‚„æœ‰ç°¡é«”ä¸­æ–‡å­—ç¬¦
"""

import re
from pathlib import Path
from collections import defaultdict

def has_simplified_chinese(text):
    """
    æª¢æ¸¬æ–‡æœ¬ä¸­æ˜¯å¦åŒ…å«ç°¡é«”ä¸­æ–‡ç‰¹å¾µå­—ç¬¦
    è¿”å›æ‰¾åˆ°çš„ç°¡é«”å­—åˆ—è¡¨
    """
    # å¸¸è¦‹çš„ç°¡é«”ä¸­æ–‡ç‰¹å¾µå­—ç¬¦ï¼ˆéµæ˜¯ç°¡é«”ï¼Œå€¼æ˜¯ç¹é«”ï¼‰
    simplified_chars = {
        'èª': 'èª', 'ç‚º': 'ç‚º', 'é€™': 'é€™', 'æ¨£': 'æ¨£', 'åœ‹': 'åœ‹',
        'ç°¡': 'ç°¡', 'ç¶“': 'ç¶“', 'ç¾': 'ç¾', 'å¯¦': 'å¯¦', 'é€²': 'é€²',
        'å€‘': 'å€‘', 'ä¾†': 'ä¾†', 'å°': 'å°', 'æœƒ': 'æœƒ', 'ç™¼': 'ç™¼',
        'å‹•': 'å‹•', 'ç”¢': 'ç”¢', 'ç¨®': 'ç¨®', 'å¾Œ': 'å¾Œ', 'å­¸': 'å­¸',
        'å•': 'å•', 'æ„': 'æ„', 'å»º': 'å»º', 'æ¢': 'æ¢', 'çµ': 'çµ',
        'é¡Œ': 'é¡Œ', 'é»¨': 'é»¨', 'æ': 'æ', 'è¼ƒ': 'è¼ƒ', 'è«–': 'è«–',
        'é‹': 'é‹', 'è¾²': 'è¾²', 'æ±º': 'æ±º', 'æ“š': 'æ“š', 'è™•': 'è™•',
        'éšŠ': 'éšŠ', 'çµ¦': 'çµ¦', 'é–€': 'é–€', 'ç†±': 'ç†±', 'é ˜': 'é ˜',
        'å°': 'å°', 'å£“': 'å£“', 'æ¿Ÿ': 'æ¿Ÿ', 'éš': 'éš', 'è¡“': 'è¡“',
        'æ¥µ': 'æ¥µ', 'è¯': 'è¯', 'è­‰': 'è­‰', 'æ”¹': 'æ”¹', 'è½‰': 'è½‰',
        'å–®': 'å–®', 'å¸¶': 'å¸¶', 'è»Š': 'è»Š', 'é”': 'é”', 'ç©': 'ç©',
        'è²': 'è²', 'å ±': 'å ±', 'é¡': 'é¡', 'é›¢': 'é›¢', 'è¯': 'è¯',
        'ç¢º': 'ç¢º', 'é¦¬': 'é¦¬', 'ç¯€': 'ç¯€', 'è©±': 'è©±', 'æº«': 'æº«',
        'å‚³': 'å‚³', 'è¨±': 'è¨±', 'å»£': 'å»£', 'è¨˜': 'è¨˜', 'ç¹”': 'ç¹”',
        'è£': 'è£', 'çœ¾': 'çœ¾', 'æ›¸': 'æ›¸', 'é©—': 'é©—', 'é€£': 'é€£',
        'æ–·': 'æ–·', 'é›£': 'é›£', 'åƒ': 'åƒ', 'ç´„': 'ç´„', 'æ­·': 'æ­·',
        'ç¨±': 'ç¨±', 'æº–': 'æº–', 'è™Ÿ': 'è™Ÿ', 'ç¶­': 'ç¶­', 'åŠƒ': 'åŠƒ',
        'é¸': 'é¸', 'æ¨™': 'æ¨™', 'å¯«': 'å¯«', 'æŸ¥': 'æŸ¥', 'å±¤': 'å±¤',
        'é©': 'é©', 'å±¬': 'å±¬', 'åœ“': 'åœ“', 'åƒ': 'åƒ', 'ç´°': 'ç´°',
        'è½': 'è½', 'éµ': 'éµ', 'åƒ¹': 'åƒ¹', 'åš´': 'åš´', 'é½Š': 'é½Š',
        'åº«': 'åº«', 'é ': 'é ', 'è«‡': 'è«‡', 'éŒ„': 'éŒ„', 'ç’°': 'ç’°',
        'è­·': 'è­·', 'è¨': 'è¨', 'ç´€': 'ç´€', 'æª¢': 'æª¢', 'è²¨': 'è²¨',
        'è©•': 'è©•', 'å¯©': 'å¯©', 'ç¾©': 'ç¾©', 'æ…®': 'æ…®', 'è‡¨': 'è‡¨',
        'å¹«': 'å¹«', 'éŠ·': 'éŠ·', 'è©¦': 'è©¦', 'ç·´': 'ç·´', 'è·': 'è·',
        'ç¹¼': 'ç¹¼', 'é›™': 'é›™', 'å¤ ': 'å¤ ', 'ç¨': 'ç¨', 'è¨ª': 'è¨ª',
        'æ­¸': 'æ­¸', 'é†«': 'é†«', 'çµ•': 'çµ•', 'æ“”': 'æ“”', 'è£œ': 'è£œ',
        'è—¥': 'è—¥', 'é¡¯': 'é¡¯', 'ç²': 'ç²', 'æ“Š': 'æ“Š', 'ç´”': 'ç´”',
        'é¡§': 'é¡§', 'é›œ': 'é›œ', 'éŒ¢': 'éŒ¢', 'æ…‹': 'æ…‹', 'æ­': 'æ­',
        'ç‡Ÿ': 'ç‡Ÿ', 'è©': 'è©', 'æ': 'æ', 'è¼‰': 'è¼‰', 'é®®': 'é®®',
        'ç«¶': 'ç«¶', 'å†Š': 'å†Š', 'è®€': 'è®€', 'èª¤': 'èª¤', 'æ“': 'æ“',
        'ç´¹': 'ç´¹', 'è²¿': 'è²¿', 'å•Ÿ': 'å•Ÿ', 'è¨º': 'è¨º', 'è¼¸': 'è¼¸',
        'ç°½': 'ç°½', 'å„„': 'å„„', 'è™›': 'è™›', 'é¡': 'é¡', 'è§¸': 'è§¸',
        'çµ¡': 'çµ¡', 'è¸': 'è¸', 'è³½': 'è³½', 'è„«': 'è„«', 'è': 'è',
        'è²¡': 'è²¡', 'éš¨': 'éš¨', 'è¬›': 'è¬›', 'æ“´': 'æ“´', 'éšª': 'éšª',
        'è¦½': 'è¦½', 'ç©©': 'ç©©', 'æ”œ': 'æ”œ', 'è¡›': 'è¡›', 'éº': 'éº',
        'é‘’': 'é‘’', 'èº': 'èº', 'è­¯': 'è­¯', 'å»¢': 'å»¢', 'ç·Š': 'ç·Š',
        'é½¡': 'é½¡', 'è³¼': 'è³¼', 'ç¼º': 'ç¼º', 'å‹µ': 'å‹µ', 'é': 'é',
        'å„€': 'å„€', 'æ¸¬': 'æ¸¬', 'æ”': 'æ”', 'è¼›': 'è¼›',
    }

    found = []
    for char, traditional in simplified_chars.items():
        if char in text:
            found.append((char, traditional))

    return found

def scan_file(file_path):
    """æƒæå–®å€‹æ–‡ä»¶"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()

        simplified_found = has_simplified_chinese(content)
        return simplified_found

    except Exception as e:
        return None

def main():
    project_root = Path(__file__).parent.parent
    print(f"ğŸ“ é …ç›®æ ¹ç›®éŒ„: {project_root}\n")
    print("ğŸ” æ­£åœ¨æƒæç°¡é«”ä¸­æ–‡å­—ç¬¦...\n")

    # æ–‡ä»¶é¡å‹
    extensions = {'.py', '.md', '.yaml', '.yml', '.json', '.txt', '.sh', '.rst'}

    # æ’é™¤ç›®éŒ„
    exclude_dirs = {
        '.git', '.venv', 'venv', '__pycache__', '.pytest_cache',
        'node_modules', '.idea', '.vscode', 'dist', 'build',
        'data_backup_', 'data_cache', 'results', 'logs', 'env'
    }

    # çµ±è¨ˆ
    total_files = 0
    files_with_simplified = 0
    simplified_chars_count = defaultdict(int)

    # æƒææ–‡ä»¶
    for root, dirs, files in os.walk(project_root):
        # éæ¿¾ç›®éŒ„
        dirs[:] = [d for d in dirs if not any(exc in d for exc in exclude_dirs)]

        for file in files:
            file_path = Path(root) / file

            if file_path.suffix not in extensions:
                continue

            total_files += 1
            result = scan_file(file_path)

            if result:
                files_with_simplified += 1
                rel_path = file_path.relative_to(project_root)
                print(f"âš ï¸  {rel_path}")
                for simp, trad in result[:5]:  # åªé¡¯ç¤ºå‰5å€‹
                    print(f"    '{simp}' â†’ '{trad}'")
                    simplified_chars_count[simp] += 1
                if len(result) > 5:
                    print(f"    ...é‚„æœ‰ {len(result) - 5} å€‹ç°¡é«”å­—")
                print()

    # è¼¸å‡ºçµ±è¨ˆ
    print(f"\n{'='*60}")
    print(f"ğŸ“Š æƒæçµæœçµ±è¨ˆ")
    print(f"{'='*60}")
    print(f"   æƒææ–‡ä»¶ç¸½æ•¸: {total_files}")
    print(f"   å«ç°¡é«”çš„æ–‡ä»¶: {files_with_simplified}")

    if simplified_chars_count:
        print(f"\n   æœ€å¸¸è¦‹çš„ç°¡é«”å­—:")
        sorted_chars = sorted(simplified_chars_count.items(), key=lambda x: x[1], reverse=True)
        for char, count in sorted_chars[:20]:
            print(f"      '{char}': {count} æ¬¡")

    if files_with_simplified == 0:
        print(f"\n   âœ… å¤ªæ£’äº†ï¼æ²’æœ‰ç™¼ç¾ç°¡é«”ä¸­æ–‡ï¼")
    else:
        print(f"\n   âš ï¸  å»ºè­°é‹è¡Œè½‰æ›å·¥å…·é€²è¡Œè™•ç†")

    print(f"{'='*60}")

import os
if __name__ == "__main__":
    main()
