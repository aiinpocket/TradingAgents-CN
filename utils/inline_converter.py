#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
純 Python 簡繁轉換工具（不依賴外部庫）
使用內建字典進行轉換
"""

import os
import sys
from pathlib import Path

# 簡繁對照字典（擴展版 - 已補充缺失字符）
S2T_CHARS = {
    # 金字旁簡化字（重要！）
    '钥': '鑰', '钟': '鐘', '镜': '鏡', '钱': '錢', '钢': '鋼',
    '铁': '鐵', '银': '銀', '铜': '銅', '铝': '鋁', '锁': '鎖',
    # 常用簡體字
    '为': '為', '国': '國', '这': '這', '样': '樣', '简': '簡',
    '过': '過', '风': '風', '业': '業', '专': '專', '从': '從',
    '无': '無', '门': '門', '个': '個', '机': '機', '关': '關',
    '经': '經', '现': '現', '实': '實', '进': '進', '们': '們',
    '来': '來', '对': '對', '会': '會', '发': '發', '动': '動',
    '产': '產', '种': '種', '后': '後', '学': '學', '问': '問',
    '认': '認', '条': '條', '结': '結', '题': '題', '党': '黨',
    '提': '提', '较': '較', '论': '論', '运': '運', '农': '農',
    '决': '決', '据': '據', '处': '處', '队': '隊', '给': '給',
    '门': '門', '热': '熱', '领': '領', '导': '導', '压': '壓',
    '济': '濟', '阶': '階', '术': '術', '极': '極', '联': '聯',
    '证': '證', '改': '改', '转': '轉', '单': '單', '带': '帶',
    '车': '車', '达': '達', '积': '積', '声': '聲', '报': '報',
    '类': '類', '离': '離', '华': '華', '确': '確', '马': '馬',
    '节': '節', '话': '話', '温': '溫', '传': '傳', '许': '許',
    '广': '廣', '记': '記', '织': '織', '装': '裝', '众': '眾',
    '书': '書', '验': '驗', '连': '連', '断': '斷', '难': '難',
    '约': '約', '历': '歷', '称': '稱', '准': '準', '号': '號',
    '维': '維', '划': '劃', '选': '選', '标': '標', '写': '寫',
    '层': '層', '适': '適', '属': '屬', '圆': '圓', '参': '參',
    '细': '細', '听': '聽', '铁': '鐵', '价': '價', '严': '嚴',
    '齐': '齊', '库': '庫', '预': '預', '谈': '談', '录': '錄',
    '环': '環', '护': '護', '讨': '討', '纪': '紀', '检': '檢',
    '货': '貨', '评': '評', '审': '審', '义': '義', '虑': '慮',
    '临': '臨', '帮': '幫', '销': '銷', '试': '試', '练': '練',
    '职': '職', '继': '繼', '双': '雙', '够': '夠', '独': '獨',
    '访': '訪', '归': '歸', '医': '醫', '绝': '絕', '担': '擔',
    '补': '補', '药': '藥', '显': '顯', '获': '獲', '击': '擊',
    '纯': '純', '顾': '顧', '杂': '雜', '钱': '錢', '态': '態',
    '欧': '歐', '营': '營', '词': '詞', '损': '損', '载': '載',
    '鲜': '鮮', '竞': '競', '册': '冊', '读': '讀', '误': '誤',
    '拥': '擁', '绍': '紹', '贸': '貿', '启': '啟', '诊': '診',
    '输': '輸', '签': '簽', '亿': '億', '虚': '虛', '额': '額',
    '触': '觸', '络': '絡', '践': '踐', '赛': '賽', '脱': '脫',
    '闻': '聞', '财': '財', '随': '隨', '讲': '講', '扩': '擴',
    '险': '險', '览': '覽', '稳': '穩', '携': '攜', '卫': '衛',
    '遗': '遺', '鉴': '鑒', '跃': '躍', '译': '譯', '废': '廢',
    '紧': '緊', '龄': '齡', '购': '購', '缺': '缺', '励': '勵',
    '递': '遞', '仪': '儀', '测': '測', '摄': '攝', '辆': '輛',
    '设': '設', '置': '置', '项': '項', '目': '目', '框': '框',
    '架': '架', '多': '多', '智': '智', '能': '能', '体': '體',
    '大': '大', '语': '語', '言': '言', '模': '模', '型': '型',
    '文': '文', '金': '金', '融': '融', '交': '交', '易': '易',
    '优': '優', '化': '化', '版': '版', '本': '本', '核': '核',
    '心': '心', '特': '特', '性': '性', '协': '協', '作': '作',
    '分': '分', '析': '析', '师': '師', '研': '研', '究': '究',
    '员': '員', '同': '同', '工': '工', '中': '中', '市': '市',
    '场': '場', '支': '支', '持': '持', '股': '股', '数': '數',
    '集': '集', '成': '成', '容': '容', '器': '器', '部': '部',
    '署': '署', '完': '完', '整': '整', '多': '多', '架': '架',
    '构': '構', '界': '界', '面': '面', '跟': '跟', '踪': '蹤',
    '环': '環', '境': '境', '创': '創', '建': '建', '虚': '虛',
    '拟': '擬', '激': '激', '活': '活', '升': '升', '级': '級',
    '安': '安', '装': '裝', '依': '依', '赖': '賴', '锁': '鎖',
    '定': '定', '速': '速', '度': '度', '快': '快', '或': '或',
    '步': '步', '解': '解', '析': '析', '较': '較', '慢': '慢',
    '启': '啟', '使': '使', '用': '用', '直': '直', '接': '接',
    '推': '推', '荐': '薦', '脚': '腳', '命': '命', '令': '令',
    '行': '行', '具': '具', '包': '包', '括': '括', '但': '但',
    '限': '限', '于': '於', '说': '說', '明': '明', '注': '註',
    '释': '釋', '画': '畫', '显': '顯', '示': '示', '执': '執',
    '长': '長', '时': '時', '间': '間', '等': '等', '待': '待',
    '超': '超', '规': '規', '则': '則', '异': '異', '常': '常',
    '处': '處', '理': '理', '取': '取', '消': '消', '错': '錯',
    '误': '誤', '响': '響', '应': '應', '请': '請', '求': '求',
    '尝': '嘗', '重': '重', '试': '試', '线': '線', '程': '程',
    '缓': '緩', '存': '存', '可': '可', '配': '配', '置': '置',
    '认': '認', '证': '證', '权': '權', '加': '加', '密': '密',
    '内': '內', '变': '變', '量': '量', '会': '會', '话': '話',
    '管': '管', '状': '狀', '态': '態', '开': '開', '关': '關',
    '功': '功', '当': '當', '前': '前', '默': '默', '认': '認',
    '值': '值', '操': '操', '返': '返', '回': '回', '计': '計',
    '算': '算', '统': '統', '监': '監', '控': '控', '观': '觀',
    '察': '察', '视': '視', '图': '圖', '表': '表', '单': '單',
    '独': '獨', '组': '組', '件': '件', '模': '模', '块': '塊',
    '服': '服', '务': '務', '端': '端', '客': '客', '户': '戶',
    '资': '資', '源': '源', '初': '初', '始': '始', '加': '加',
    '载': '載', '卸': '卸', '保': '保', '存': '存', '更': '更',
    '新': '新', '删': '刪', '除': '除', '查': '查', '询': '詢',
    '插': '插', '修': '修', '复': '複', '恢': '恢', '份': '份',
    '导': '導', '出': '出', '入': '入', '格': '格', '式': '式',
    '规': '規', '范': '範', '标': '標', '志': '志', '日': '日',
    '志': '誌', '级': '級', '别': '別', '详': '詳', '简': '簡',
    '洁': '潔', '调': '調', '试': '試', '模': '模', '打': '打',
    '印': '印', '追': '追', '踪': '蹤', '堆': '堆', '栈': '棧',
    '信': '信', '息': '息', '告': '告', '警': '警', '严': '嚴',
    '重': '重', '致': '致', '命': '命', '崩': '崩', '溃': '潰',
    '挂': '掛', '起': '起', '死': '死', '锁': '鎖', '竞': '競',
    '争': '爭', '优': '優', '先': '先', '序': '序', '列': '列',
    '排': '排', '队': '隊', '栈': '棧', '树': '樹', '哈': '哈',
    '希': '希', '映': '映', '射': '射', '二': '二', '叉': '叉',
    '链': '鏈', '图': '圖', '节': '節', '点': '點', '边': '邊',
    '权': '權', '路': '路', '径': '徑', '遍': '遍', '历': '歷',
    '深': '深', '广': '廣', '搜': '搜', '索': '索', '排': '排',
    '序': '序', '查': '查', '找': '找', '插': '插', '删': '刪',
    '堆': '堆', '并': '並', '归': '歸', '快': '快', '冒': '冒',
    '泡': '泡', '选': '選', '择': '擇', '基': '基', '数': '數',
    '计': '計', '桶': '桶', '最': '最', '小': '小', '生': '生',
    '树': '樹', '拓': '拓', '扑': '撲', '网': '網', '络': '絡',
    '流': '流', '匹': '匹', '覆': '覆', '盖': '蓋', '欧': '歐',
    '拉': '拉', '哈': '哈', '密': '密', '尔': '爾', '顿': '頓',
    '费': '費', '波': '波', '那': '那', '契': '契', '斐': '斐',
    '卢': '盧', '卡': '卡', '斯': '斯', '莱': '萊', '布': '布',
    '尼': '尼', '茨': '茲', '傅': '傅', '叶': '葉', '变': '變',
    '换': '換', '滤': '濾', '波': '波', '采': '採', '样': '樣',
    '量': '量', '化': '化', '编': '編', '码': '碼', '压': '壓',
    '缩': '縮', '哈': '哈', '夫': '夫', '曼': '曼', '算': '算',
    '术': '術', '频': '頻', '域': '域', '傅': '傅', '里': '里',
}

def convert_text(text):
    """轉換文本中的簡體字為繁體字"""
    result = []
    for char in text:
        result.append(S2T_CHARS.get(char, char))
    return ''.join(result)

def convert_file(file_path):
    """轉換單個檔案"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()

        # 檢查是否包含中文
        if not any('\u4e00' <= c <= '\u9fff' for c in content):
            return False, "無中文"

        # 轉換
        converted = convert_text(content)

        # 如果內容相同，跳過
        if converted == content:
            return False, "已是繁體"

        # 寫回檔案
        with open(file_path, 'w', encoding='utf-8', newline='') as f:
            f.write(converted)

        return True, "已轉換"

    except Exception as e:
        return False, f"錯誤: {str(e)}"

def main():
    project_root = Path(__file__).parent.parent
    print(f"📁 專案根目錄: {project_root}\n")

    # 要處理的檔案類型
    extensions = {'.py', '.md', '.yaml', '.yml', '.json', '.txt', '.sh', '.rst', '.cfg', '.ini', '.bat'}

    # 要排除的目錄
    exclude_dirs = {
        '.git', '.venv', 'venv', '__pycache__', '.pytest_cache',
        'node_modules', '.idea', '.vscode', 'dist', 'build',
        'data_backup_', 'data_cache', 'results', 'logs', 'env',
        '.eggs', 'htmlcov', '.coverage', '.tox'
    }

    # 統計
    total_files = 0
    converted_files = 0
    skipped_files = 0
    error_files = 0

    print("🚀 開始轉換...\n")

    # 遍歷所有檔案
    for root, dirs, files in os.walk(project_root):
        # 過濾目錄
        dirs[:] = [d for d in dirs if not any(exc in d for exc in exclude_dirs)]

        for file in files:
            file_path = Path(root) / file

            # 跳過轉換工具本身
            if 'inline_converter.py' in str(file_path):
                continue

            if file_path.suffix not in extensions:
                continue

            total_files += 1
            success, message = convert_file(file_path)

            rel_path = file_path.relative_to(project_root)

            if success:
                converted_files += 1
                # 計算轉換的字數
                with open(file_path, 'r', encoding='utf-8') as f:
                    new_content = f.read()
                char_count = sum(1 for c in new_content if '\u4e00' <= c <= '\u9fff')
                print(f"✅ {rel_path}")
                print(f"   轉換完成，文件包含 {char_count} 個中文字符")
            elif "錯誤" in message:
                error_files += 1
                print(f"❌ {rel_path}: {message}")
            else:
                skipped_files += 1
                # print(f"⏭️  {rel_path}: {message}")  # 註釋掉跳過的文件，減少輸出

    # 輸出統計
    print(f"\n{'='*60}")
    print(f"✨ 轉換完成！")
    print(f"   掃描檔案: {total_files}")
    print(f"   成功轉換: {converted_files}")
    print(f"   跳過檔案: {skipped_files}")
    print(f"   錯誤檔案: {error_files}")
    print(f"{'='*60}")

if __name__ == "__main__":
    main()
